# ููุชุฑุฉ ุฑุณุงุฆู ุงููุธุงู ูู ููุญุฉ ุงูุฃุฏูู

## ๐ ุงููุดููุฉ

ุนูุฏ ุนุฑุถ ุงููุญุงุฏุซุงุช ูู ููุญุฉ ุงูุฃุฏููุ ูุงูุช ุฑุณุงุฆู ุงููุณุชุฎุฏู ุชุญุชูู ุนูู ูุต ุงููุธุงู ุงูุชุงูู:

```
ูุนูููุงุช ูู ุงููุธุงู: ูุฌุจ ุฏุงุฆูุง ุนุฏู ุฐูุฑ ุงู ููุชุฌ ุบูุฑ ููุฌูุฏ ูู  ูุงุนุฏู ุงูุจูุงูุงุช
```

ูุฐุง ุงููุต ูุชู ุฅุถุงูุชู ุชููุงุฆูุงู ูู ุงููุธุงู ููู ุฑุณุงูุฉ ูุณุชุฎุฏูุ ูููู ูุง ูุฌุจ ุฃู ูุธูุฑ ูู ูุงุฌูุฉ ุงูุฃุฏูู.

---

## โ ุงูุญู ุงููุทุจู

### ุงูุชูููุฐ ูู `AdminChatbot.tsx`:

```typescript
{conversationDetails.messages?.map((message: any) => {
  // ุฅุฒุงูุฉ ูุต ุงููุธุงู ูู ุฑุณุงุฆู ุงููุณุชุฎุฏู
  const cleanContent = message.role === 'user' 
    ? message.content.replace(/ูุนูููุงุช ูู ุงููุธุงู: ูุฌุจ ุฏุงุฆูุง ุนุฏู ุฐูุฑ ุงู ููุชุฌ ุบูุฑ ููุฌูุฏ ูู\s+ูุงุนุฏู ุงูุจูุงูุงุช/g, '').trim()
    : message.content;
  
  return (
    <div key={message.id}>
      <p className="text-sm whitespace-pre-wrap">{cleanContent}</p>
    </div>
  );
})}
```

---

## ๐ง ููู ูุนูู

### 1. **ุงููุญุต ุญุณุจ ุงูุฏูุฑ**:
```typescript
message.role === 'user'
```
- ูุชู ุชุทุจูู ุงูููุชุฑุฉ ููุท ุนูู ุฑุณุงุฆู ุงููุณุชุฎุฏู
- ุฑุณุงุฆู ุงูุจูุช (assistant) ุชุจูู ููุง ูู

### 2. **ุงุณุชุฎุฏุงู Regex**:
```typescript
/ูุนูููุงุช ูู ุงููุธุงู: ูุฌุจ ุฏุงุฆูุง ุนุฏู ุฐูุฑ ุงู ููุชุฌ ุบูุฑ ููุฌูุฏ ูู\s+ูุงุนุฏู ุงูุจูุงูุงุช/g
```
- `\s+` ูุทุงุจู ูุณุงูุฉ ูุงุญุฏุฉ ุฃู ุฃูุซุฑ (ููุชุนุงูู ูุน ุงููุณุงูุงุช ุงููุฎุชููุฉ)
- `g` flag ูุฅุฒุงูุฉ ุฌููุน ุงูุชุทุงุจูุงุช (global)

### 3. **ุชูุธูู ุงููุต**:
```typescript
.replace(...).trim()
```
- `replace()` ูุฒูู ุงููุต ุงููุทุงุจู
- `trim()` ูุฒูู ุงููุณุงูุงุช ุงูุฒุงุฆุฏุฉ ูู ุงูุจุฏุงูุฉ ูุงูููุงูุฉ

---

## ๐ ุฃูุซูุฉ

### ูุจู:
```
ููู ุญุงููููุนูููุงุช ูู ุงููุธุงู: ูุฌุจ ุฏุงุฆูุง ุนุฏู ุฐูุฑ ุงู ููุชุฌ ุบูุฑ ููุฌูุฏ ูู  ูุงุนุฏู ุงูุจูุงูุงุช
```

### ุจุนุฏ:
```
ููู ุญุงููู
```

---

## ๐ฏ ูุชู ูุชู ุงูุชุทุจูู

### ูุชู ุงูููุชุฑุฉ ูู:
- โ Dialog ุชูุงุตูู ุงููุญุงุฏุซุฉ ูู ููุญุฉ ุงูุฃุฏูู
- โ ุนูุฏ ุนุฑุถ ุฌููุน ุฑุณุงุฆู ุงููุญุงุฏุซุฉ

### ูุง ูุชู ุงูููุชุฑุฉ ูู:
- โ ูุงุนุฏุฉ ุงูุจูุงูุงุช (ุงูุฑุณุงูุฉ ุงูุฃุตููุฉ ุชุจูู ููุง ูู)
- โ ุงูู API responses (ุงูุจูุงูุงุช ุงูุฎุงู ุชุจูู ููุง ูู)
- โ ูุงุฌูุฉ ุงูุนููุงุก (ุงูุนููู ูุง ูุฑู ูุฐู ุงูุฑุณุงุฆู ุฃุตูุงู)

---

## ๐ ุชูุงุตูู ุชูููุฉ

### ุงูููุฏ ุงููุงูู:

```typescript
{conversationDetails.messages?.map((message: any) => {
  // ุฅุฒุงูุฉ ูุต ุงููุธุงู ูู ุฑุณุงุฆู ุงููุณุชุฎุฏู
  const cleanContent = message.role === 'user' 
    ? message.content.replace(
        /ูุนูููุงุช ูู ุงููุธุงู: ูุฌุจ ุฏุงุฆูุง ุนุฏู ุฐูุฑ ุงู ููุชุฌ ุบูุฑ ููุฌูุฏ ูู\s+ูุงุนุฏู ุงูุจูุงูุงุช/g, 
        ''
      ).trim()
    : message.content;
  
  return (
    <div
      key={message.id}
      className={`flex ${
        message.role === 'user' 
          ? (isRTL ? 'justify-start' : 'justify-end') 
          : (isRTL ? 'justify-end' : 'justify-start')
      }`}
    >
      <div
        className={`max-w-[80%] rounded-2xl px-4 py-3 ${
          message.role === 'user'
            ? 'bg-gray-700 text-white'
            : 'bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100'
        }`}
      >
        <p className="text-sm whitespace-pre-wrap">{cleanContent}</p>
        <p className="text-xs mt-1 opacity-70">
          {new Date(message.sent_at).toLocaleTimeString(isRTL ? 'ar-SA' : 'en-US')}
        </p>
      </div>
    </div>
  );
})}
```

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### ุณููุงุฑูู 1: ุฑุณุงูุฉ ุนุงุฏูุฉ
**ุงููุฏุฎู**:
```json
{
  "role": "user",
  "content": "ูุฑุญุจุงู"
}
```

**ุงููุฎุฑุฌ**:
```
ูุฑุญุจุงู
```

### ุณููุงุฑูู 2: ุฑุณุงูุฉ ูุน ูุต ุงููุธุงู
**ุงููุฏุฎู**:
```json
{
  "role": "user",
  "content": "ููู ุญุงููููุนูููุงุช ูู ุงููุธุงู: ูุฌุจ ุฏุงุฆูุง ุนุฏู ุฐูุฑ ุงู ููุชุฌ ุบูุฑ ููุฌูุฏ ูู  ูุงุนุฏู ุงูุจูุงูุงุช"
}
```

**ุงููุฎุฑุฌ**:
```
ููู ุญุงููู
```

### ุณููุงุฑูู 3: ุฑุณุงูุฉ ุงูุจูุช
**ุงููุฏุฎู**:
```json
{
  "role": "assistant",
  "content": "ุฃููุงู ุจู! ูุนูููุงุช ูู ุงููุธุงู: ูุฌุจ ุฏุงุฆูุง ุนุฏู ุฐูุฑ ุงู ููุชุฌ ุบูุฑ ููุฌูุฏ ูู  ูุงุนุฏู ุงูุจูุงูุงุช"
}
```

**ุงููุฎุฑุฌ** (ุจุฏูู ุชุบููุฑ):
```
ุฃููุงู ุจู! ูุนูููุงุช ูู ุงููุธุงู: ูุฌุจ ุฏุงุฆูุง ุนุฏู ุฐูุฑ ุงู ููุชุฌ ุบูุฑ ููุฌูุฏ ูู  ูุงุนุฏู ุงูุจูุงูุงุช
```

---

## ๐ ูููุน ุงูุชุนุฏูู

**ุงูููู**: `front-end/src/pages/admin/AdminChatbot.tsx`

**ุงูุฃุณุทุฑ**: 1138-1164

**ุงูุฏุงูุฉ**: ุนุฑุถ ุชูุงุตูู ุงููุญุงุฏุซุฉ ูู Dialog

---

## ๐ ุงูุชุญุณููุงุช ุงููุณุชูุจููุฉ

### 1. **ููุชุฑุฉ ูุชุนุฏุฏุฉ**:
ุฅุฐุง ูุงู ููุงู ูุตูุต ูุธุงู ุฃุฎุฑู:
```typescript
const systemTexts = [
  /ูุนูููุงุช ูู ุงููุธุงู: ูุฌุจ ุฏุงุฆูุง ุนุฏู ุฐูุฑ ุงู ููุชุฌ ุบูุฑ ููุฌูุฏ ูู\s+ูุงุนุฏู ุงูุจูุงูุงุช/g,
  /ูุต ูุธุงู ุขุฎุฑ/g,
  // ุงููุฒูุฏ...
];

let cleanContent = message.content;
if (message.role === 'user') {
  systemTexts.forEach(regex => {
    cleanContent = cleanContent.replace(regex, '').trim();
  });
}
```

### 2. **ุฏุงูุฉ ูููุตูุฉ**:
```typescript
const cleanSystemText = (content: string, isUserMessage: boolean): string => {
  if (!isUserMessage) return content;
  
  return content
    .replace(/ูุนูููุงุช ูู ุงููุธุงู: ูุฌุจ ุฏุงุฆูุง ุนุฏู ุฐูุฑ ุงู ููุชุฌ ุบูุฑ ููุฌูุฏ ูู\s+ูุงุนุฏู ุงูุจูุงูุงุช/g, '')
    .trim();
};

// ุงูุงุณุชุฎุฏุงู
const cleanContent = cleanSystemText(message.content, message.role === 'user');
```

### 3. **ุชุฎุฒูู ูู constants**:
```typescript
// constants/systemMessages.ts
export const SYSTEM_MESSAGE_PATTERNS = {
  PRODUCT_WARNING: /ูุนูููุงุช ูู ุงููุธุงู: ูุฌุจ ุฏุงุฆูุง ุนุฏู ุฐูุฑ ุงู ููุชุฌ ุบูุฑ ููุฌูุฏ ูู\s+ูุงุนุฏู ุงูุจูุงูุงุช/g,
};

// ุงูุงุณุชุฎุฏุงู
import { SYSTEM_MESSAGE_PATTERNS } from '@/constants/systemMessages';

const cleanContent = message.role === 'user' 
  ? message.content.replace(SYSTEM_MESSAGE_PATTERNS.PRODUCT_WARNING, '').trim()
  : message.content;
```

---

## ๐จ ููุงุญุธุงุช ูููุฉ

### 1. **ุงูุจูุงูุงุช ุงูุฃุตููุฉ**:
- ุงูููุชุฑุฉ ุชุญุฏุซ ููุท ุนูุฏ ุงูุนุฑุถ (Client-side)
- ุงูุจูุงูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุชุจูู ููุง ูู
- ุงูู API responses ุชุญุชูู ุนูู ุงููุต ุงููุงูู

### 2. **ุงูุฃุฏุงุก**:
- Regex ูุชู ุชุทุจููู ุนูู ูู ุฑุณุงูุฉ ุนูุฏ ุงูุนุฑุถ
- ูุง ูุคุซุฑ ุนูู ุงูุฃุฏุงุก ุฅูุง ูู ุงููุญุงุฏุซุงุช ุงูุทูููุฉ ุฌุฏุงู (>1000 ุฑุณุงูุฉ)
- ูููู ุชุญุณููู ุจุงุณุชุฎุฏุงู useMemo ุฅุฐุง ูุฒู ุงูุฃูุฑ

### 3. **ุงูุชูุงูููุฉ**:
- ูุนูู ูุน ุฌููุน ุงููุชุตูุญุงุช ุงูุญุฏูุซุฉ
- Regex ูู JavaScript ูุฏุนูู ุจุดูู ูุงูู
- ูุง ุญุงุฌุฉ ูู polyfills

---

## ๐จ ุงูุจุฏุงุฆู

### ุงูุจุฏูู 1: ููุชุฑุฉ ูู Backend
```php
// ูู Laravel Controller
public function show($sessionId) {
    $conversation = Conversation::with('messages')->find($sessionId);
    
    $conversation->messages = $conversation->messages->map(function($message) {
        if ($message->role === 'user') {
            $message->content = preg_replace(
                '/ูุนูููุงุช ูู ุงููุธุงู: ูุฌุจ ุฏุงุฆูุง ุนุฏู ุฐูุฑ ุงู ููุชุฌ ุบูุฑ ููุฌูุฏ ูู\s+ูุงุนุฏู ุงูุจูุงูุงุช/',
                '',
                $message->content
            );
        }
        return $message;
    });
    
    return response()->json($conversation);
}
```

**ุงููููุฒุงุช**:
- โ ููุชุฑุฉ ูุฑูุฒูุฉ
- โ ูููู ุญุฌู ุงูุจูุงูุงุช ุงููููููุฉ

**ุงูุนููุจ**:
- โ ูุบูุฑ ุงูุจูุงูุงุช ูุจู ุงูุฅุฑุณุงู
- โ ุตุนุจ ุชุชุจุน ุงูุจูุงูุงุช ุงูุฃุตููุฉ

### ุงูุจุฏูู 2: ุงุณุชุฎุฏุงู useMemo
```typescript
const cleanedMessages = useMemo(() => {
  return conversationDetails?.messages?.map(message => ({
    ...message,
    content: message.role === 'user'
      ? message.content.replace(/ูุนูููุงุช ูู ุงููุธุงู: ูุฌุจ ุฏุงุฆูุง ุนุฏู ุฐูุฑ ุงู ููุชุฌ ุบูุฑ ููุฌูุฏ ูู\s+ูุงุนุฏู ุงูุจูุงูุงุช/g, '').trim()
      : message.content
  }));
}, [conversationDetails?.messages]);

// ุซู ุงุณุชุฎุฏุงู cleanedMessages ูู ุงูุนุฑุถ
```

**ุงููููุฒุงุช**:
- โ ุฃุฏุงุก ุฃูุถู (ูุง ูุนูุฏ ุงูุญุณุงุจ ุฅูุง ุนูุฏ ุงูุชุบููุฑ)
- โ ููุฏ ุฃูุธู

**ุงูุนููุจ**:
- โ ุฃูุซุฑ ุชุนููุฏุงู ููููุงู

---

## ๐ ุงูุฎูุงุตุฉ

ุชู ุชุทุจูู ููุชุฑุฉ ุจุณูุทุฉ ููุนุงูุฉ ูุฅุฒุงูุฉ ูุต ุงููุธุงู ูู ุฑุณุงุฆู ุงููุณุชุฎุฏู ุนูุฏ ุนุฑุถูุง ูู ููุญุฉ ุงูุฃุฏูู:

- โ ูุนูู ููุท ุนูู ุฑุณุงุฆู ุงููุณุชุฎุฏู
- โ ูุง ูุคุซุฑ ุนูู ุงูุจูุงูุงุช ุงูุฃุตููุฉ
- โ ููุฏ ุจุณูุท ููุงุถุญ
- โ ูุง ูุคุซุฑ ุนูู ุงูุฃุฏุงุก
- โ ุณูู ุงูุตูุงูุฉ ูุงูุชุญุฏูุซ

---

ุชู ุงูุชุญุฏูุซ ุจุชุงุฑูุฎ: 22 ุฃูุชูุจุฑ 2025
ุงูุฅุตุฏุงุฑ: 1.0

